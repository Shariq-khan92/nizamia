generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Designation {
  id             String   @id @default(uuid())
  organizationId String
  name           String   @unique
  description    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model User {
  id             String   @id @default(uuid())
  organizationId String
  name           String
  username       String   @unique
  password       String
  role           String   @default("User")
  lastActive     DateTime @default(now())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Buyer {
  id              String   @id @default(uuid())
  organizationId  String
  name            String
  logoUrl         String?
  website         String?
  country         String?
  companyPhone    String?
  paymentTerms    String?
  incoterms       String?
  agentName       String?
  agentCommission Float?
  addresses       String?
  contacts        String?
  orders          Order[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Supplier {
  id             String   @id @default(uuid())
  organizationId String
  name           String
  category       String?
  rating         Float?
  location       String?
  contactPerson  String?
  phone          String?
  address        String?
  salesTaxId     String?
  productLine    String?
  creditTerms    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Order {
  id               String   @id @default(uuid())
  organizationId   String
  orderID          String   @unique
  poNumber         String?
  styleNo          String?
  buyerId          String?
  buyer            Buyer?   @relation(fields: [buyerId], references: [id])
  merchandiserName String?
  quantity         Int?
  poDate           DateTime?
  deliveryDate     DateTime?
  plannedDate      DateTime?
  status           String   @default("Draft")
  amount           Float?
  price            Float?
  factoryRef       String?
  styleName        String?
  styleDescription String?
  fabricName       String?
  fabricDescription String?
  incoterms        String?
  shipMode         String?
  imageUrl         String?
  
  sizeGroups       SizeGroup[]
  bom              BomItem[]
  samplingDetails  SampleRow[]
  
  criticalPath     String?

  planningNotes    String?
  statusReason     String?
  
  colors           String? // JSON
  fitting          String? // JSON
  washing          String? // JSON
  embellishments   String? // JSON
  finishing        String? // JSON
  skippedStages    String? // JSON
  
  bomStatus        String?
  createdBy        String?

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model SizeGroup {
  id        String   @id @default(uuid())
  orderId   String
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  groupName String?
  unitPrice String?
  currency  String?
  sizes     String?
  colors    String?
  breakdown String?
}

model BomItem {
  id              String   @id @default(uuid())
  orderId         String
  order           Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  processGroup    String?
  componentName   String?
  itemDetail      String?
  supplierRef     String?
  vendor          String?
  sourcingStatus  String?
  labStatus       String?
  leadTimeDays    Int?
  usageRule       String?
  usageData       String?
  wastagePercent  Float?
  isTestingRequired Boolean?
  isApproved      Boolean?
  uom             String?
  unitsPerPack    Int?
  packingUnit     String?
}

model SampleRow {
  id              String   @id @default(uuid())
  orderId         String
  order           Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  samNumber       String?
  type            String?
  fabric          String?
  shade           String?
  wash            String?
  baseSize        String?
  threadColor     String?
  zipperColor     String?
  lining          String?
  quantity        String?
  deadline        String?
  status          String?
  labStatus       String?
  isTestingRequired Boolean?
  isApproved      Boolean?
  currentStage    String?
  lastUpdated     String?
}

model CompanySettings {
  id             String   @id @default(uuid())
  organizationId String
  taxRate        Float?
  cottonRate     Float?
  currencyRates  String?  // JSON string: {"USD": 1, "EUR": 0.92, "GBP": 0.79}
  lastUpdated    DateTime?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model SalesTerms {
  id             String   @id @default(uuid())
  organizationId String
  name           String   // e.g., "Default Sales Terms", "Bulk Order Terms"
  content        String   @db.Text
  isDefault      Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model POTerms {
  id             String   @id @default(uuid())
  organizationId String
  name           String
  content        String   @db.Text
  isDefault      Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model MonthlyTarget {
  id             String   @id @default(uuid())
  organizationId String
  month          String
  salesTarget    Float
  volumeTarget   Float
  year           Int      @default(2026)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  @@unique([organizationId, month, year])
}

model Location {
  id             String   @id @default(uuid())
  organizationId String
  name           String   @unique
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model ThreadOperation {
  id             String   @id @default(uuid())
  organizationId String
  category       String   // e.g., "Tops", "Bottoms", "Universal"
  name           String   // e.g., "Front Rise", "Shoulder Join"
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model MachineFactor {
  id             String   @id @default(uuid())
  organizationId String
  machineType    String   @unique // e.g., "Lockstitch", "Overlock / Serger"
  factor         Float    // e.g., 2.5, 3.5
  description    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model GarmentTemplate {
  id             String   @id @default(uuid())
  organizationId String
  name           String   // e.g., "Jeans", "Jacket", "Shirt"
  description    String?
  GarmentTemplateStep GarmentTemplateStep[]
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model GarmentTemplateStep {
  id             String   @id @default(uuid())
  templateId     String
  template       GarmentTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  stepOrder      Int
  operation      String
  machineType    String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model ProductionLine {
  id             String   @id @default(uuid())
  organizationId String
  name           String
  description    String?
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model PackingInstruction {
  id             String   @id @default(uuid())
  organizationId String
  name           String
  content        String   @db.Text
  isDefault      Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model ProcessStep {
  id             String   @id @default(uuid())
  organizationId String
  name           String
  description    String?
  sequenceOrder  Int
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model BuyingAgency {
  id                String   @id @default(uuid())
  organizationId    String
  name              String
  contactPerson     String?
  phone             String?
  address           String?
  linkedBuyers      String?  // JSON array stored as string
  activeOrdersCount Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model MasterBOMItem {
  id             String   @id @default(uuid())
  organizationId String
  type           String   // 'Fabric' or 'Trim'
  category       String?
  supplier       String?
  brand          String?
  uom            String?
  isNominated    Boolean  @default(false)
  price          Float?
  code           String?
  construction   String?
  content        String?
  weight         Float?
  width          String?
  shade          String?
  warpShrinkage  Float?
  weftShrinkage  Float?
  itemName       String?
  details        String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model BOMPreset {
  id             String   @id @default(uuid())
  organizationId String
  name           String
  buyerName      String?
  items          String?  @db.Text // JSON array of MasterBOMItem IDs stored as string
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model JobBatch {
  id               String   @id @default(uuid())
  organizationId   String
  batchName        String
  styles           String?  @db.Text // JSON array of Order IDs
  totalQty         Int      @default(0)
  status           String   @default("Planning") // Planning, Ready to Ship, Booked, Shipped, Completed
  exFactoryDate    String?
  plans            String?  @db.Text // JSON object with plan statuses
  purchasingRequests String? @db.Text // JSON array
  workOrderRequests  String? @db.Text // JSON array
  cuttingPlanDetails String? @db.Text // JSON array
  dailyLogs        String?  @db.Text // JSON array
  productionProgress String? @db.Text // JSON object
  stageSchedules   String?  @db.Text // JSON object
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model IssuedWorkOrder {
  id             String   @id @default(uuid())
  organizationId String
  jobId          String?
  woNumber       String
  vendorName     String?
  stage          String?
  dateIssued     String?
  targetDate     String?
  status         String   @default("Issued") // Issued, In Progress, Completed
  items          String?  @db.Text // JSON array of WorkOrderRequest
  notes          String?
  totalQty       Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model IssuedPurchaseOrder {
  id             String   @id @default(uuid())
  organizationId String
  jobId          String?
  poNumber       String
  supplierId     String?
  supplierName   String?
  issueDate      String?
  deliveryDate   String?
  items          String?  @db.Text // JSON array of PurchasingRequest items
  totalAmount    Float?
  currency       String?
  status         String   @default("Pending") // Pending, Issued, Partial, Received
  terms          String?
  attachments    String?  @db.Text // JSON array of file references
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model DevelopmentSample {
  id               String   @id @default(uuid())
  organizationId   String
  samNumber        String?
  buyer            String?
  styleNo          String?
  type             String?
  fabric           String?
  shade            String?
  wash             String?
  baseSize         String?
  threadColor      String?
  zipperColor      String?
  lining           String?
  quantity         String?
  deadline         String?
  status           String   @default("Pending")
  labStatus        String?
  isTestingRequired Boolean @default(false)
  season           String?
  notes            String?  @db.Text
  currentStage     String?
  lastUpdated      String?
  commentsReceivedDate String?
  commentsSentBy   String?
  emailAttachmentRef String?
  imageUrl         String?
  description      String?  @db.Text
  fitName          String?
  specsFile        String?
  bom              String?  @db.Text // JSON array
  embellishments   String?  @db.Text // JSON array
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model Parcel {
  id             String   @id @default(uuid())
  organizationId String
  orderId        String?
  jobId          String?
  parcelNumber   String?
  buyer          String?
  recipientName  String?
  recipientPhone String?
  address        String?
  courier        String?
  trackingNo     String?
  sentDate       String?
  receivedDate   String?
  cartons        Int      @default(0)
  grossWeight    Float?
  netWeight      Float?
  cbm            Float?
  shippingMark   String?
  dispatchDate   String?
  status         String   @default("Pending") // Pending, Packed, Dispatched, Delivered
  documents      String?  @db.Text // JSON array of document references
  samples        String?  @db.Text // JSON array
  otherItems     String?  @db.Text // JSON array
  isTrackingPending Boolean @default(false)
  invoiceRef     String?
  containerNo    String?
  sealNo         String?
  destination    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model CalendarEvent {
  id             String   @id @default(uuid())
  organizationId String
  title          String
  description    String?  @db.Text
  startDate      String
  endDate        String?
  type           String?  // order, shipment, meeting, deadline, custom
  relatedOrderId String?
  color          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}


